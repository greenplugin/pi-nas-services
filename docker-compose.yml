version: "3.6"

services:
  pptpd:
    build: ./pptpd
    container_name: pptpd
    volumes:
      - ./pptpd/pptpd.conf:/etc/pptpd.conf
      - ./pptpd/pptpd-options.conf:/etc/ppp/pptpd-options
      - ./pptpd/chap-secrets:/etc/ppp/chap-secrets
    privileged: true
    network_mode: host
    restart: always
    ports:
      - 0.0.0.0:1723:1723
  pi_admin_backend:
    build: ./pi-admin/backend
    container_name: pi_admin_backend
    volumes:
      - ./pptpd/pptpd.conf:/config/pptpd/pptpd.conf
      - ./pptpd/pptpd-options.conf:/config/pptpd/pptpd-options
      - ./pptpd/chap-secrets:/config/pptpd/chap-secrets
      - ./pi-admin/backend:/var/app/backend
      - /var/run/docker.sock:/var/run/docker.sock
    privileged: true
    restart: always
    ports:
      - 3000:3000
  pi_admin_frontend:
    build: ./pi-admin/frontend
    container_name: pi_admin_frontend
    volumes:
      - ./pi-admin/frontend:/var/app/frontend
    restart: always
    ports:
      - 4200:4200

  minidlna:
    build: ./minidlna
    container_name: minidlna
    restart: always
    volumes:
      - /storage/media/Video:/media:ro
    environment:
      - MINIDLNA_media_dir=V,/media
      - MINIDLNA_friendly_name=MiniDLNA
      - MINIDLNA_merge_media_dirs=yes
      - MINIDLNA_force_sort_criteria= upnp:class, upnp:originalTrackNumber, dc:title
      - MINIDLNA_root_container=B
    network_mode: host
